<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Take-Home Pay Calculator</title>
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --accent: #111827;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .wrap {
      max-width: 760px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 { font-size: 22px; margin: 8px 0 2px; }
    p.lead { color: var(--muted); margin: 0 0 12px; font-size: 14px; }
    .grid { display: grid; gap: 12px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    label { display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      background: #fff;
      color: var(--text);
      outline: none;
    }
    input[type="number"]:focus { border-color: #cbd5e1; }
    .quick {
      display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;
    }
    .chip {
      border: 1px solid var(--border);
      background: #f1f5f9;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
    }
    .muted { color: var(--muted); }
    .title { font-weight: 600; font-size: 16px; margin: 0 0 6px; }
    .rowline { display:flex; align-items:baseline; justify-content:space-between; padding: 6px 0; border-bottom: 1px dashed #eef2f7; }
    .rowline:last-child { border-bottom: none; }
    .bold { font-weight: 600; }
    .note { font-size: 12px; color: var(--muted); margin-top: 8px; }
    .footer { text-align:center; font-size: 12px; color: var(--muted); margin-top: 16px; }
    .warning { color:#b45309; font-size: 12px; }
    .success { color:#065f46; font-size: 12px; }
    .spacer { height: 6px; }
    @media (max-width: 480px) {
      .row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Take-Home Pay Calculator</h1>
    <p class="lead">Tiered commission (capped at 10% from $26,000+) + SMB + SALARY, then multiplied by your tax keep-rate (e.g., 73%).</p>

    <div class="grid">
      <div class="card">
        <label for="margin">Current Margin ($)</label>
        <input id="margin" type="number" inputmode="decimal" value="17504.24" step="0.01">
        <div class="quick" id="quickBtns"></div>
      </div>

      <div class="row">
        <div class="card">
          <label for="smb">Store Manager Bonus (SMB) $</label>
          <input id="smb" type="number" inputmode="decimal" value="500" step="1">
        </div>
        <div class="card">
          <label for="salary">SALARY $</label>
          <input id="salary" type="number" inputmode="decimal" value="944" step="1">
        </div>
      </div>

      <div class="card">
        <label for="tax">Tax Keep-Rate (%)</label>
        <input id="tax" type="number" inputmode="decimal" value="73" step="0.1">
        <div class="note">This is the percentage of gross (commission + SMB + SALARY) that you keep after taxes. Example: 73 means keep 73%.</div>
      </div>

      <div class="card">
        <div class="title">Results</div>
        <div id="results"></div>
      </div>

      <div class="card" id="explainCard">
        <div class="title">How your rate is calculated</div>
        <div class="muted" id="explain"></div>
      </div>
    </div>

    <div class="footer">Commission starts at $5,000 margin (1.6%), +0.2% every $500, capped at <b>10%</b> (from $26,000+). Max steps = 42.</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const marginEl = $("margin");
    const smbEl = $("smb");
    const salaryEl = $("salary");
    const taxEl = $("tax");
    const resultsEl = $("results");
    const explainEl = $("explain");
    const quickBtns = $("quickBtns");

    const presets = [5000, 5500, 6000, 8000, 10000, 15000, 20000, 26000, 30000];
    presets.forEach(v => {
      const b = document.createElement("button");
      b.className = "chip";
      b.textContent = v.toLocaleString();
      b.addEventListener("click", () => { marginEl.value = v.toFixed(2); compute(); });
      quickBtns.appendChild(b);
    });
    const plus500 = document.createElement("button");
    plus500.className = "chip";
    plus500.textContent = "+$500";
    plus500.addEventListener("click", () => {
      const cur = parseNumber(marginEl.value);
      marginEl.value = (cur + 500).toFixed(2);
      compute();
    });
    quickBtns.appendChild(plus500);

    [marginEl, smbEl, salaryEl, taxEl].forEach(el => el.addEventListener("input", compute));

    function parseNumber(v) {
      if (typeof v !== "string") v = String(v ?? "");
      v = v.replace(/,/g, "");
      const n = parseFloat(v);
      return Number.isFinite(n) ? n : 0;
    }
    function fmt(n, digits=2) {
      try { return n.toLocaleString(undefined, { minimumFractionDigits: digits, maximumFractionDigits: digits }); }
      catch(e) { return (Math.round(n * 100)/100).toFixed(digits); }
    }

    function compute() {
      const M = parseNumber(marginEl.value);
      const SMB = parseNumber(smbEl.value);
      const SAL = parseNumber(salaryEl.value);
      let taxPct = parseNumber(taxEl.value);
      if (!Number.isFinite(taxPct)) taxPct = 0;
      taxPct = Math.max(0, Math.min(100, taxPct));

      // Steps: from $5,000 upward in $500 increments. Cap steps so rate <= 10%.
      const cappedForSteps = Math.min(M, 30000); // still allow margin input above, but step calc caps by 30k window
      const rawSteps = (cappedForSteps - 5000) / 500;
      let steps = M >= 5000 ? Math.max(0, Math.floor(rawSteps)) : 0;
      const MAX_STEPS = 42; // 0.016 + 0.002*42 = 0.100 (10%), hits at $26,000
      if (steps > MAX_STEPS) steps = MAX_STEPS;

      // Rate
      let rate = M >= 5000 ? 0.016 + 0.002 * steps : 0;
      if (rate > 0.10) rate = 0.10; // hard cap safeguard

      const commission = M * rate;
      const gross = commission + SMB + SAL;
      const takeHome = gross * (taxPct / 100);

      const below = M < 5000;
      const atCap = !below && rate >= 0.10;

      resultsEl.innerHTML = `
        <div class="rowline"><span class="muted">Margin (M)</span><span>$ ${fmt(M)}</span></div>
        <div class="rowline"><span class="muted">Rate</span><span>${below ? '<span class="muted">0% (below $5,000)</span>' : (rate*100).toFixed(1) + '%'} ${atCap ? '<span class="success"> (capped)</span>' : ''}</span></div>
        <div class="rowline"><span class="muted">Commission</span><span>$ ${fmt(commission)}</span></div>
        <div class="rowline"><span class="muted">SMB + SALARY</span><span>$ ${fmt(SMB + SAL)}</span></div>
        <div class="rowline"><span class="muted">Gross (Comm + SMB + SAL)</span><span>$ ${fmt(gross)}</span></div>
        <div class="rowline bold"><span class="muted">Take-Home (${fmt(taxPct,0)}%)</span><span>$ ${fmt(takeHome)}</span></div>
      `;

      explainEl.innerHTML = below
        ? `<div class="warning">Below $5,000 margin: commission is 0%. SMB and SALARY still count toward take-home.</div>`
        : `Steps = ⌊(min(M, 30,000) − 5,000) / 500⌋ = <b>${steps}</b><br>
           Rate = min( 1.6% + 0.2% × Steps , <b>10%</b> ) = <b>${(rate*100).toFixed(1)}%</b><br>
           10% cap begins at $26,000 margin.`;
    }

    compute();
  </script>
</body>
</html>
